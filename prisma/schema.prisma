generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                                String                             @id @default(cuid())
  email                             String                             @unique
  emailVerified                     DateTime?
  name                              String
  password                          String?
  image                             String?
  role                              String                             @default("user")
  disabled                          Boolean                            @default(false)
  stripeCustomerId                  String?
  subscriptionStatus                String?                            @default("trial")
  companyId                         String?
  createdAt                         DateTime                           @default(now())
  updatedAt                         DateTime                           @updatedAt
  accessActorLogs                   AccessAuditLog[]                   @relation("AccessActor")
  accessTargetLogs                  AccessAuditLog[]                   @relation("AccessTarget")
  accounts                          Account[]
  activities                        Activity[]
  assetsCreated                     Asset[]                            @relation("AssetCreator")
  companyDocumentsCreated           CompanyComplianceDocument[]        @relation("CompanyComplianceDocumentCreator")
  companyDocumentUploads            CompanyComplianceDocumentVersion[] @relation("CompanyComplianceDocumentUploader")
  complianceActivitiesAuthored      ComplianceActivity[]               @relation("ComplianceActivityActor")
  complianceImages                  ComplianceCertificationImage[]     @relation("ComplianceImageUploader")
  complianceEmployeesCreated        ComplianceEmployee[]               @relation("ComplianceEmployeeCreator")
  complianceEmployeesUpdated        ComplianceEmployee[]               @relation("ComplianceEmployeeUpdater")
  complianceSnapshots               ComplianceSnapshot[]               @relation("ComplianceSnapshotCreator")
  createdContacts                   Contact[]                          @relation("ContactCreator")
  ownedContacts                     Contact[]                          @relation("ContactOwner")
  contactCalls                      ContactCall[]                      @relation("ContactCallCreator")
  contactMeetings                   ContactMeeting[]                   @relation("ContactMeetingCreator")
  contactSocials                    ContactSocialTouch[]               @relation("ContactSocialCreator")
  assignedDeals                     Deal[]                             @relation("AssignedEstimator")
  createdDeals                      Deal[]                             @relation("DealCreator")
  dispatchOwnerships                DispatchRequest[]                  @relation("DispatchOwner")
  authoredEmails                    Email[]                            @relation("EmailAuthor")
  emailAccounts                     EmailAccount[]
  emailOAuthStates                  EmailOAuthState[]
  emailSignaturesCreated            EmailSignature[]
  emailTemplatesCreated             EmailTemplate[]                    @relation("EmailTemplateCreator")
  emailTemplatesUpdated             EmailTemplate[]                    @relation("EmailTemplateUpdater")
  estimatesCreated                  Estimate[]                         @relation("EstimateCreator")
  estimateDocumentsGenerated        EstimateDocument[]                 @relation("EstimateDocumentGenerator")
  estimateEmailsSent                EstimateEmail[]                    @relation("EstimateEmailSender")
  estimateRevisionsApproved         EstimateRevision[]                 @relation("EstimateRevisionApprover")
  estimateRevisionsSubmitted        EstimateRevision[]                 @relation("EstimateRevisionSubmitter")
  estimatesDispatched               Estimate[]                         @relation("EstimateDispatchSender")
  notes                             Note[]
  sessions                          Session[]
  settingsUpdated                   SystemSetting[]                    @relation("SystemSettingUpdatedBy")
  tasks                             Task[]
  company                           Company?                           @relation(fields: [companyId], references: [id])
  sentInvites                       UserInvite[]                       @relation("InviteSender")
  workOrderOverrides                WorkOrder[]                        @relation("WorkOrderOverrideApprover")
  workOrderActivities               WorkOrderActivity[]                @relation("WorkOrderActivityActor")
  workOrderAssetAssignmentsAuthored WorkOrderAssetAssignment[]         @relation("WorkOrderAssetAssignmentAssigner")
  workOrderAssetAssignmentsRemoved  WorkOrderAssetAssignment[]         @relation("WorkOrderAssetAssignmentRemover")
  workOrderAssignmentsAuthored      WorkOrderAssignment[]              @relation("WorkOrderAssignmentAssigner")
  workOrderAssignmentsOverrides     WorkOrderAssignment[]              @relation("WorkOrderAssignmentOverrideActor")
  workOrderDocumentsUploaded        WorkOrderDocument[]                @relation("WorkOrderDocumentUploader")
  workOrderPdfsGenerated            WorkOrderPdf[]                     @relation("WorkOrderPdfGenerator")
  workOrderPresetsAdded             WorkOrderPreset[]                  @relation("WorkOrderPresetAdder")
  dealBidDocumentsUploaded          DealBidDocument[]                  @relation("DealBidDocumentUploader")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Company {
  id                         String                      @id @default(cuid())
  name                       String
  industry                   String
  address                    String?
  city                       String?
  state                      String?
  zipCode                    String?
  phone                      String?
  email                      String?
  website                    String?
  notes                      String?
  kind                       CompanyKind                 @default(client)
  planKey                    PlanKey                     @default(starter)
  starterStartedAt           DateTime?
  starterExpiresAt           DateTime?
  stripeCustomerId           String?
  stripeSubscriptionId       String?
  stripeSeatQuantity         Int?
  stripeSeatItemId           String?
  createdAt                  DateTime                    @default(now())
  updatedAt                  DateTime                    @updatedAt
  accessAuditLogs            AccessAuditLog[]
  activities                 Activity[]
  assets                     Asset[]
  companyComplianceDocuments CompanyComplianceDocument[]
  complianceActivities       ComplianceActivity[]
  complianceEmployees        ComplianceEmployee[]
  compliancePresets          CompliancePreset[]
  contacts                   Contact[]
  contactCalls               ContactCall[]
  contactMeetings            ContactMeeting[]
  contactSocialTouches       ContactSocialTouch[]
  deals                      Deal[]
  dispatchPresets            DispatchPreset[]
  dispatchRequests           DispatchRequest[]
  emails                     Email[]
  emailAccounts              EmailAccount[]
  emailAttachments           EmailAttachment[]
  emailIngestionQueue        EmailIngestionQueue[]
  emailOAuthStates           EmailOAuthState[]
  emailIntegrations          EmailIntegration[]
  emailRecipientPreferences  EmailRecipientPreference[]
  emailSignatures            EmailSignature[]
  emailTemplates             EmailTemplate[]
  estimates                  Estimate[]
  estimateDocuments          EstimateDocument[]
  estimateEmails             EstimateEmail[]
  estimateLineItems          EstimateLineItem[]
  estimatingPresets          EstimatingPreset[]
  systemSettings             SystemSetting[]
  users                      User[]
  userInvites                UserInvite[]
  workOrders                 WorkOrder[]
  workOrderActivities        WorkOrderActivity[]
  workOrderDocuments         WorkOrderDocument[]
  workOrderPdfs              WorkOrderPdf[]
  dealBidDocuments           DealBidDocument[]
}

model Contact {
  id                  String               @id @default(cuid())
  companyId           String
  firstName           String
  lastName            String
  email               String
  phone               String?
  mobile              String?
  jobTitle            String?
  derivedCompanyName  String               @default("")
  companyOverrideName String?
  ownerId             String
  createdById         String
  isSystem            Boolean              @default(false)
  lastActivityAt      DateTime             @default(now())
  activityState       ContactActivityState @default(NEW)
  archived            Boolean              @default(false)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  activities          Activity[]
  company             Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy           User                 @relation("ContactCreator", fields: [createdById], references: [id])
  owner               User                 @relation("ContactOwner", fields: [ownerId], references: [id])
  calls               ContactCall[]
  meetings            ContactMeeting[]
  socials             ContactSocialTouch[]
  deals               Deal[]
  dealEmails          DealEmail[]
  dealPdfs            DealPdf[]
  dispatchRequests    DispatchRequest[]
  emails              Email[]
  emailAttachments    EmailAttachment[]
  estimates           Estimate[]
  estimateDocuments   EstimateDocument[]
  estimateEmails      EstimateEmail[]
  notes               Note[]
  tasks               Task[]
  workOrders          WorkOrder[]

  @@unique([companyId, email])
  @@index([companyId, archived])
  @@index([ownerId])
  @@index([companyId, isSystem])
}

model Deal {
  id             String         @id @default(cuid())
  name           String
  description    String?
  stage          String         @default("New")
  pipeline       String         @default("Main")
  value          Float?
  probability    Int?
  closeDate      DateTime?
  lostReason     String?
  contactId      String
  companyId      String?
  assignedToId   String?
  createdById    String?
  currentVersion Int            @default(1)
  isApproved     Boolean        @default(false)
  sentToEstimatingAt DateTime?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  activities     Activity[]
  assignedTo     User?          @relation("AssignedEstimator", fields: [assignedToId], references: [id])
  company        Company?       @relation(fields: [companyId], references: [id])
  contact        Contact        @relation(fields: [contactId], references: [id], onDelete: Cascade)
  createdBy      User?          @relation("DealCreator", fields: [createdById], references: [id])
  emails         DealEmail[]
  lineItems      DealLineItem[]
  pdfs           DealPdf[]
  versions       DealVersion[]
  estimate       Estimate?
  notes          Note[]
  tasks          Task[]
  bidDocuments   DealBidDocument[]
}

model DealVersion {
  id          String         @id @default(cuid())
  dealId      String
  version     Int
  description String?
  totalValue  Float          @default(0)
  approvedAt  DateTime?
  approvedBy  String?
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  lineItems   DealLineItem[]
  pdfs        DealPdf[]
  deal        Deal           @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@unique([dealId, version])
}

model DealLineItem {
  id          String      @id @default(cuid())
  dealId      String
  versionId   String
  category    String
  description String
  quantity    Float       @default(1)
  unit        String?
  unitPrice   Float
  totalPrice  Float
  notes       String?
  sortOrder   Int         @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  deal        Deal        @relation(fields: [dealId], references: [id], onDelete: Cascade)
  version     DealVersion @relation(fields: [versionId], references: [id], onDelete: Cascade)
}

model DealPdf {
  id          String      @id @default(cuid())
  dealId      String
  contactId   String
  versionId   String
  fileName    String
  fileUrl     String
  fileSize    Int?
  generatedAt DateTime    @default(now())
  contact     Contact     @relation(fields: [contactId], references: [id], onDelete: Cascade)
  deal        Deal        @relation(fields: [dealId], references: [id], onDelete: Cascade)
  version     DealVersion @relation(fields: [versionId], references: [id], onDelete: Cascade)

  @@index([contactId])
}

model DealBidDocument {
  id           String                @id @default(cuid())
  companyId    String
  dealId       String
  uploadedById String
  category     BidDocumentCategory
  fileName     String
  mimeType     String
  storageKey   String
  fileSize     Int
  checksumHash String
  uploadedAt   DateTime              @default(now()) @db.Timestamptz(6)
  company      Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  deal         Deal                  @relation(fields: [dealId], references: [id], onDelete: Cascade)
  uploadedBy   User                  @relation("DealBidDocumentUploader", fields: [uploadedById], references: [id])

  @@index([companyId])
  @@index([dealId])
  @@index([uploadedById])
  @@index([uploadedAt])
}

model DealEmail {
  id        String   @id @default(cuid())
  dealId    String
  contactId String
  subject   String
  body      String
  to        String
  from      String
  cc        String?
  bcc       String?
  sentAt    DateTime @default(now())
  status    String   @default("sent")
  contact   Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
  deal      Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@index([contactId])
}

model Activity {
  id          String   @id @default(cuid())
  companyId   String
  type        String
  subject     String
  description String?
  metadata    Json?
  contactId   String
  dealId      String?
  userId      String?
  createdAt   DateTime @default(now())
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact     Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
  deal        Deal?    @relation(fields: [dealId], references: [id], onDelete: Cascade)
  user        User?    @relation(fields: [userId], references: [id])

  @@index([companyId])
  @@index([contactId])
  @@index([dealId])
  @@index([userId])
  @@index([createdAt])
  @@index([type])
}

model Task {
  id           String    @id @default(cuid())
  title        String
  description  String?
  dueDate      DateTime?
  completed    Boolean   @default(false)
  completedAt  DateTime?
  priority     String    @default("medium")
  notes        String?
  contactId    String
  dealId       String?
  assignedToId String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  assignedTo   User?     @relation(fields: [assignedToId], references: [id])
  contact      Contact   @relation(fields: [contactId], references: [id], onDelete: Cascade)
  deal         Deal?     @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@index([assignedToId])
  @@index([dueDate])
  @@index([completed])
  @@index([contactId])
}

model Note {
  id          String   @id @default(cuid())
  content     String
  mentions    String?
  contactId   String
  dealId      String?
  createdById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  contact     Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
  createdBy   User?    @relation(fields: [createdById], references: [id])
  deal        Deal?    @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@index([contactId])
}

model ContactCall {
  id              String               @id @default(cuid())
  companyId       String
  contactId       String
  createdById     String
  direction       ContactCallDirection
  result          String
  durationMinutes Int?
  notes           String?
  happenedAt      DateTime             @default(now())
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  company         Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact         Contact              @relation(fields: [contactId], references: [id], onDelete: Cascade)
  createdBy       User                 @relation("ContactCallCreator", fields: [createdById], references: [id])

  @@index([companyId])
  @@index([contactId])
  @@index([createdById])
  @@index([happenedAt])
}

model ContactMeeting {
  id              String             @id @default(cuid())
  companyId       String
  contactId       String
  createdById     String
  meetingType     ContactMeetingType
  scheduledFor    DateTime
  durationMinutes Int?
  attendees       Json?
  outcome         String?
  notes           String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  company         Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact         Contact            @relation(fields: [contactId], references: [id], onDelete: Cascade)
  createdBy       User               @relation("ContactMeetingCreator", fields: [createdById], references: [id])

  @@index([companyId])
  @@index([contactId])
  @@index([createdById])
  @@index([scheduledFor])
}

model ContactSocialTouch {
  id          String                @id @default(cuid())
  companyId   String
  contactId   String
  createdById String
  platform    ContactSocialPlatform
  action      String
  notes       String?
  occurredAt  DateTime              @default(now())
  createdAt   DateTime              @default(now())
  updatedAt   DateTime              @updatedAt
  company     Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact     Contact               @relation(fields: [contactId], references: [id], onDelete: Cascade)
  createdBy   User                  @relation("ContactSocialCreator", fields: [createdById], references: [id])

  @@index([companyId])
  @@index([contactId])
  @@index([createdById])
  @@index([occurredAt])
}

model EmailAccount {
  id                   String                @id @default(cuid())
  companyId            String
  userId               String
  provider             EmailProvider
  emailAddress         String
  displayName          String?
  label                String?
  refreshToken         String
  accessToken          String?
  accessTokenExpiresAt DateTime?
  scopes               Json?
  syncCursor           String?
  syncStatus           String                @default("idle")
  syncError            String?
  lastSyncedAt         DateTime?
  metadata             Json?
  isPrimary            Boolean               @default(false)
  deauthorizedAt       DateTime?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  emails               Email[]
  company              Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user                 User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  attachments          EmailAttachment[]
  ingestionJobs        EmailIngestionQueue[]

  @@unique([companyId, emailAddress])
  @@index([companyId])
  @@index([userId])
  @@index([provider])
}

model EmailOAuthState {
  id           String        @id @default(cuid())
  companyId    String
  userId       String
  provider     EmailProvider
  state        String        @unique
  codeVerifier String
  redirectUri  String
  scopes       Json?
  expiresAt    DateTime
  createdAt    DateTime      @default(now())
  company      Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([provider])
  @@index([expiresAt])
}

model Email {
  id                        String            @id @default(cuid())
  companyId                 String
  contactId                 String
  accountId                 String
  provider                  EmailProvider
  direction                 EmailDirection
  subject                   String
  snippet                   String?
  bodyHtml                  String?
  bodyText                  String?
  fromAddress               String
  replyToAddress            String?
  toAddresses               Json
  ccAddresses               Json?
  bccAddresses              Json?
  threadId                  String?
  messageId                 String
  externalId                String?
  references                Json?
  authorId                  String?
  sentAt                    DateTime
  receivedAt                DateTime?
  syncedAt                  DateTime          @default(now())
  status                    String?           @default("recorded")
  error                     String?
  requiresContactResolution Boolean           @default(false)
  account                   EmailAccount      @relation(fields: [accountId], references: [id], onDelete: Cascade)
  author                    User?             @relation("EmailAuthor", fields: [authorId], references: [id])
  company                   Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact                   Contact           @relation(fields: [contactId], references: [id], onDelete: Cascade)
  attachments               EmailAttachment[]

  @@unique([companyId, messageId])
  @@index([companyId])
  @@index([contactId, sentAt])
  @@index([accountId, sentAt])
  @@index([authorId])
  @@index([direction])
  @@index([threadId])
}

model EmailIntegration {
  id             String        @id @default(cuid())
  companyId      String
  provider       EmailProvider
  status         String        @default("disconnected")
  isActive       Boolean       @default(false)
  metadata       Json?
  connectedAt    DateTime?
  disconnectedAt DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  company        Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, provider])
  @@index([companyId])
}

model EmailAttachment {
  id         String        @id @default(cuid())
  companyId  String
  contactId  String
  emailId    String
  accountId  String?
  fileName   String
  mimeType   String
  size       Int?
  storageKey String
  externalId String?
  checksum   String?
  isInline   Boolean       @default(false)
  createdAt  DateTime      @default(now())
  account    EmailAccount? @relation(fields: [accountId], references: [id])
  company    Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact    Contact       @relation(fields: [contactId], references: [id], onDelete: Cascade)
  email      Email         @relation(fields: [emailId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([contactId])
  @@index([emailId])
}

model EmailIngestionQueue {
  id         String       @id @default(cuid())
  companyId  String
  accountId  String
  runAt      DateTime     @default(now())
  lockedAt   DateTime?
  lockedBy   String?
  syncCursor String?
  attempts   Int          @default(0)
  lastError  String?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  account    EmailAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  company    Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([accountId])
  @@index([runAt])
}

model ComplianceEmployee {
  id               String                    @id @default(cuid())
  employeeId       String                    @unique
  companyId        String
  firstName        String
  lastName         String
  title            String
  role             String
  active           Boolean                   @default(true)
  complianceStatus ComplianceStatus          @default(INCOMPLETE)
  lastVerifiedAt   DateTime?
  complianceHash   String?
  createdAt        DateTime                  @default(now())
  updatedAt        DateTime                  @updatedAt
  qrToken          String                    @unique
  email            String?
  createdById      String
  updatedById      String
  activities       ComplianceActivity[]
  certifications   ComplianceCertification[]
  documents        ComplianceDocument[]
  company          Company                   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy        User                      @relation("ComplianceEmployeeCreator", fields: [createdById], references: [id])
  updatedBy        User                      @relation("ComplianceEmployeeUpdater", fields: [updatedById], references: [id])
  qrTokens         ComplianceQrToken[]
  snapshots        ComplianceSnapshot[]
  assignments      WorkOrderAssignment[]

  @@index([companyId, createdById])
  @@index([companyId, updatedById])
}

model ComplianceCertification {
  id         String                         @id @default(cuid())
  employeeId String
  presetKey  String?
  customName String?
  category   ComplianceCategory
  required   Boolean                        @default(true)
  issueDate  DateTime
  expiresAt  DateTime
  status     CertificationStatus            @default(INCOMPLETE)
  createdAt  DateTime                       @default(now())
  updatedAt  DateTime                       @updatedAt
  activities ComplianceActivity[]
  employee   ComplianceEmployee             @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  images     ComplianceCertificationImage[]

  @@index([employeeId])
}

model ComplianceCertificationImage {
  id              String                  @id @default(cuid())
  certificationId String
  version         Int
  bucket          String
  objectKey       String
  filename        String
  mimeType        String
  size            Int
  sha256          String
  uploadedById    String
  uploadedAt      DateTime                @default(now())
  certification   ComplianceCertification @relation(fields: [certificationId], references: [id], onDelete: Cascade)
  uploadedBy      User                    @relation("ComplianceImageUploader", fields: [uploadedById], references: [id])

  @@unique([certificationId, version])
  @@index([uploadedById])
}

model ComplianceDocument {
  id         String             @id @default(cuid())
  employeeId String
  title      String
  version    Int
  bucket     String
  objectKey  String
  filename   String
  size       Int
  sha256     String
  createdAt  DateTime           @default(now())
  employee   ComplianceEmployee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, version])
}

model CompanyComplianceDocument {
  id          String                             @id @default(cuid())
  companyId   String
  category    CompanyComplianceDocumentCategory
  title       String
  createdById String
  createdAt   DateTime                           @default(now())
  company     Company                            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy   User                               @relation("CompanyComplianceDocumentCreator", fields: [createdById], references: [id])
  versions    CompanyComplianceDocumentVersion[]
  activities  ComplianceActivity[]

  @@index([companyId, category])
}

model CompanyComplianceDocumentVersion {
  id            String                    @id @default(cuid())
  documentId    String
  versionNumber Int
  gcsObjectKey  String
  fileName      String
  mimeType      String
  fileHash      String
  fileSize      Int
  uploadedById  String
  uploadedAt    DateTime                  @default(now())
  document      CompanyComplianceDocument @relation(fields: [documentId], references: [id], onDelete: Cascade)
  uploadedBy    User                      @relation("CompanyComplianceDocumentUploader", fields: [uploadedById], references: [id])
  activities    ComplianceActivity[]

  @@unique([documentId, versionNumber])
}

model ComplianceActivity {
  id                       String                            @id @default(cuid())
  employeeId               String?
  type                     ComplianceActivityType
  metadata                 Json?
  createdAt                DateTime                          @default(now())
  actorId                  String?
  certificationId          String?
  companyDocumentId        String?
  companyDocumentVersionId String?
  companyId                String?
  actor                    User?                             @relation("ComplianceActivityActor", fields: [actorId], references: [id])
  certification            ComplianceCertification?          @relation(fields: [certificationId], references: [id])
  companyDocument          CompanyComplianceDocument?        @relation(fields: [companyDocumentId], references: [id])
  companyDocumentVersion   CompanyComplianceDocumentVersion? @relation(fields: [companyDocumentVersionId], references: [id])
  company                  Company?                          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  employee                 ComplianceEmployee?               @relation(fields: [employeeId], references: [id])

  @@index([companyId])
  @@index([employeeId])
  @@index([type])
}

model ComplianceSnapshot {
  id                   String                @id @default(cuid())
  employeeId           String
  snapshotHash         String
  payload              Json
  createdAt            DateTime              @default(now())
  createdById          String
  failureReasons       Json                  @default("[]")
  qrToken              ComplianceQrToken?
  createdBy            User                  @relation("ComplianceSnapshotCreator", fields: [createdById], references: [id])
  employee             ComplianceEmployee    @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  workOrderAssignments WorkOrderAssignment[]

  @@index([employeeId])
}

model ComplianceQrToken {
  id         String             @id @default(cuid())
  token      String             @unique
  employeeId String
  snapshotId String             @unique
  createdAt  DateTime           @default(now())
  employee   ComplianceEmployee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  snapshot   ComplianceSnapshot @relation(fields: [snapshotId], references: [id], onDelete: Cascade)
}

model CompliancePreset {
  id        String             @id @default(cuid())
  companyId String
  category  ComplianceCategory
  baseKey   String
  name      String
  enabled   Boolean            @default(true)
  order     Int
  isOther   Boolean            @default(false)
  locked    Boolean            @default(false)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  company   Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, category, baseKey])
  @@index([companyId, category])
}

model DispatchPreset {
  id                   String              @id @default(cuid())
  companyId            String
  scope                DispatchPresetScope
  name                 String
  description          String?
  defaultNotes         String?
  locked               Boolean             @default(false)
  isOther              Boolean             @default(false)
  enabled              Boolean             @default(true)
  sortOrder            Int                 @default(0)
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  defaultScope         String?
  suggestedDisciplines Json?
  suggestedEquipment   Json?
  company              Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  workOrderPresets     WorkOrderPreset[]

  @@unique([companyId, scope, name])
  @@index([companyId, scope, sortOrder])
}

model Estimate {
  id                     String             @id @default(cuid())
  companyId              String
  dealId                 String?            @unique
  contactId              String
  quoteNumber            String             @unique
  createdById            String
  currentRevisionId      String?            @unique
  status                 EstimateStatus     @default(DRAFT)
  currentRevisionNumber  Int                @default(1)
  revisionCount          Int                @default(0)
  submittedAt            DateTime?
  approvedAt             DateTime?
  sentToDispatchAt       DateTime?
  sentToDispatchById     String?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt
  approvedRevisionNumber Int?
  dispatchRequests       DispatchRequest[]
  company                Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact                Contact            @relation(fields: [contactId], references: [id])
  createdBy              User               @relation("EstimateCreator", fields: [createdById], references: [id])
  sentToDispatchBy       User?              @relation("EstimateDispatchSender", fields: [sentToDispatchById], references: [id])
  currentRevision        EstimateRevision?  @relation("EstimateCurrentRevision", fields: [currentRevisionId], references: [id])
  deal                   Deal?              @relation(fields: [dealId], references: [id])
  documents              EstimateDocument[]
  emails                 EstimateEmail[]
  lineItems              EstimateLineItem[]
  revisions              EstimateRevision[]
  workOrders             WorkOrder[]

  @@index([companyId])
  @@index([contactId])
  @@index([sentToDispatchById])
}

model EstimateRevision {
  id                   String             @id @default(cuid())
  estimateId           String
  revisionNumber       Int
  status               EstimateStatus     @default(DRAFT)
  submittedById        String?
  approvedById         String?
  submittedAt          DateTime?
  approvedAt           DateTime?
  notes                String?
  quoteNumber          String
  projectName          String
  projectLocation      String?
  industry             EstimateIndustry
  scopeOfWork          String
  assumptions          String?
  exclusions           String?
  contactNameSnapshot  String
  contactEmailSnapshot String?
  subtotal             Decimal            @default(0) @db.Decimal(18, 2)
  markupPercent        Decimal?           @db.Decimal(5, 2)
  markupAmount         Decimal?           @db.Decimal(18, 2)
  overheadPercent      Decimal?           @db.Decimal(5, 2)
  overheadAmount       Decimal?           @db.Decimal(18, 2)
  grandTotal           Decimal            @default(0) @db.Decimal(18, 2)
  manualOverrideTotal  Decimal?           @db.Decimal(18, 2)
  overrideReason       String?
  pricingNotes         String?
  locked               Boolean            @default(false)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  currentFor           Estimate?          @relation("EstimateCurrentRevision")
  documents            EstimateDocument[]
  emails               EstimateEmail[]
  lineItems            EstimateLineItem[]
  approvedBy           User?              @relation("EstimateRevisionApprover", fields: [approvedById], references: [id])
  estimate             Estimate           @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  submittedBy          User?              @relation("EstimateRevisionSubmitter", fields: [submittedById], references: [id])

  @@unique([estimateId, revisionNumber])
  @@index([submittedById])
  @@index([approvedById])
}

model EstimatingPreset {
  id                 String                 @id @default(cuid())
  companyId          String
  baseKey            String
  label              String
  defaultDescription String
  defaultUnit        String
  defaultUnitCost    Decimal                @default(0) @db.Decimal(18, 2)
  industry           EstimatePresetIndustry
  enabled            Boolean                @default(true)
  sortOrder          Int                    @default(0)
  isOther            Boolean                @default(false)
  locked             Boolean                @default(false)
  createdAt          DateTime               @default(now())
  updatedAt          DateTime               @updatedAt
  lineItems          EstimateLineItem[]
  company            Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, baseKey])
  @@index([companyId, industry])
}

model EstimateLineItem {
  id             String                 @id @default(cuid())
  companyId      String
  estimateId     String
  revisionId     String
  presetId       String
  presetBaseKey  String
  presetLabel    String
  presetIndustry EstimatePresetIndustry
  description    String
  quantity       Decimal                @default(1) @db.Decimal(12, 2)
  unit           String
  unitCost       Decimal                @db.Decimal(18, 2)
  lineTotal      Decimal                @db.Decimal(18, 2)
  notes          String?
  sortOrder      Int                    @default(0)
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  presetCategory EstimatePresetIndustry
  company        Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  estimate       Estimate               @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  preset         EstimatingPreset       @relation(fields: [presetId], references: [id])
  revision       EstimateRevision       @relation(fields: [revisionId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([estimateId])
  @@index([revisionId])
}

model EstimateDocument {
  id            String               @id @default(cuid())
  companyId     String
  estimateId    String
  revisionId    String
  contactId     String
  kind          EstimateDocumentKind
  storageKey    String
  fileName      String
  fileSize      Int
  hash          String
  generatedById String
  generatedAt   DateTime             @default(now())
  company       Company              @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact       Contact              @relation(fields: [contactId], references: [id], onDelete: Cascade)
  estimate      Estimate             @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  generatedBy   User                 @relation("EstimateDocumentGenerator", fields: [generatedById], references: [id])
  revision      EstimateRevision     @relation(fields: [revisionId], references: [id], onDelete: Cascade)
  emailUsages   EstimateEmail[]      @relation("EstimateEmailDocument")

  @@index([companyId])
  @@index([estimateId, kind])
  @@index([contactId])
}

model EstimateEmail {
  id            String            @id @default(cuid())
  companyId     String
  estimateId    String
  revisionId    String
  contactId     String
  templateId    String?
  signatureId   String?
  toRecipients  Json
  ccRecipients  Json?
  bccRecipients Json?
  subject       String
  body          String
  sentById      String
  pdfDocumentId String?
  sentAt        DateTime          @default(now())
  company       Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact       Contact           @relation(fields: [contactId], references: [id], onDelete: Cascade)
  estimate      Estimate          @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  pdfDocument   EstimateDocument? @relation("EstimateEmailDocument", fields: [pdfDocumentId], references: [id])
  revision      EstimateRevision  @relation(fields: [revisionId], references: [id], onDelete: Cascade)
  sentBy        User              @relation("EstimateEmailSender", fields: [sentById], references: [id])
  signature     EmailSignature?   @relation(fields: [signatureId], references: [id])
  template      EmailTemplate?    @relation(fields: [templateId], references: [id])

  @@index([companyId])
  @@index([contactId])
}

model DispatchRequest {
  id                     String                @id @default(cuid())
  companyId              String
  estimateId             String?
  contactId              String
  dispatcherId           String?
  status                 DispatchRequestStatus @default(QUEUED)
  priority               String                @default("standard")
  queuedAt               DateTime              @default(now())
  scheduledFor           DateTime?
  complianceBlocked      Boolean               @default(false)
  blockReason            String?
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @updatedAt
  approvedRevisionNumber Int?
  contactNameSnapshot    String?
  contactEmailSnapshot   String?
  scopeSummary           String?
  industry               EstimateIndustry?
  subtotal               Decimal?              @db.Decimal(18, 2)
  grandTotal             Decimal?              @db.Decimal(18, 2)
  company                Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact                Contact               @relation(fields: [contactId], references: [id])
  dispatcher             User?                 @relation("DispatchOwner", fields: [dispatcherId], references: [id])
  estimate               Estimate?             @relation(fields: [estimateId], references: [id])
  workOrders             WorkOrder[]

  @@index([companyId])
  @@index([contactId])
  @@index([status])
}

model WorkOrder {
  id                   String                     @id @default(cuid())
  companyId            String
  dispatchRequestId    String?
  contactId            String
  title                String
  status               WorkOrderStatus            @default(DRAFT)
  manualEntry          Boolean                    @default(false)
  complianceBlocked    Boolean                    @default(false)
  blockReason          String?
  overrideApproved     Boolean                    @default(false)
  overrideApprovedById String?
  overrideApprovedAt   DateTime?
  closedAt             DateTime?
  createdAt            DateTime                   @default(now())
  updatedAt            DateTime                   @updatedAt
  estimateId           String?
  discipline           WorkOrderDiscipline        @default(CONSTRUCTION)
  scheduledAt          DateTime?
  startedAt            DateTime?
  completedAt          DateTime?
  cancelledAt          DateTime?
  operationsNotes      String?
  gateAccessCode       String?
  onsitePocName        String?
  onsitePocPhone       String?
  specialInstructions  String?
  company              Company                    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contact              Contact                    @relation(fields: [contactId], references: [id])
  dispatchRequest      DispatchRequest?           @relation(fields: [dispatchRequestId], references: [id])
  estimate             Estimate?                  @relation(fields: [estimateId], references: [id])
  overrideApprovedBy   User?                      @relation("WorkOrderOverrideApprover", fields: [overrideApprovedById], references: [id])
  activities           WorkOrderActivity[]
  assetAssignments     WorkOrderAssetAssignment[]
  assignments          WorkOrderAssignment[]
  documents            WorkOrderDocument[]
  pdfs                 WorkOrderPdf[]
  presets              WorkOrderPreset[]

  @@index([companyId])
  @@index([contactId])
  @@index([status])
  @@index([estimateId])
  @@index([companyId, discipline])
}

model WorkOrderDocument {
  id           String    @id @default(cuid())
  companyId    String
  workOrderId  String
  uploadedById String
  fileName     String
  fileType     String
  mimeType     String
  storageKey   String
  fileSize     Int
  checksumHash String
  createdAt    DateTime  @default(now()) @db.Timestamptz(6)
  company      Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  uploadedBy   User      @relation("WorkOrderDocumentUploader", fields: [uploadedById], references: [id])
  workOrder    WorkOrder @relation(fields: [workOrderId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([workOrderId])
  @@index([uploadedById])
  @@index([createdAt])
}

model WorkOrderPdf {
  id            String    @id @default(cuid())
  companyId     String
  workOrderId   String
  version       Int
  storageKey    String
  fileSize      Int
  generatedById String
  createdAt     DateTime  @default(now()) @db.Timestamptz(6)
  company       Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  generatedBy   User      @relation("WorkOrderPdfGenerator", fields: [generatedById], references: [id])
  workOrder     WorkOrder @relation(fields: [workOrderId], references: [id], onDelete: Cascade)

  @@unique([workOrderId, version])
  @@index([companyId])
  @@index([generatedById])
}

model WorkOrderPreset {
  id                           String              @id @default(cuid())
  workOrderId                  String
  presetId                     String
  overriddenNotes              String?
  addedById                    String?
  addedAt                      DateTime            @default(now())
  updatedAt                    DateTime            @updatedAt
  defaultNotesSnapshot         String?
  defaultScopeSnapshot         String?
  descriptionSnapshot          String?
  isOtherSnapshot              Boolean             @default(false)
  lockedSnapshot               Boolean             @default(false)
  nameSnapshot                 String
  scopeSnapshot                DispatchPresetScope
  suggestedDisciplinesSnapshot Json?
  suggestedEquipmentSnapshot   Json?
  addedBy                      User?               @relation("WorkOrderPresetAdder", fields: [addedById], references: [id])
  preset                       DispatchPreset      @relation(fields: [presetId], references: [id], onDelete: Cascade)
  workOrder                    WorkOrder           @relation(fields: [workOrderId], references: [id], onDelete: Cascade)

  @@unique([workOrderId, presetId])
  @@index([presetId])
}

model WorkOrderAssignment {
  id                     String              @id @default(cuid())
  workOrderId            String
  employeeId             String
  assignedAt             DateTime            @default(now())
  unassignedAt           DateTime?
  assignedById           String?
  complianceSnapshotHash String?
  complianceSnapshotId   String?
  complianceStatus       ComplianceStatus?
  gapSummary             Json?
  notifiedAt             DateTime?
  overrideAcknowledged   Boolean             @default(false)
  overrideActorId        String?
  overrideAt             DateTime?
  overrideReason         String?
  assignedBy             User?               @relation("WorkOrderAssignmentAssigner", fields: [assignedById], references: [id])
  complianceSnapshot     ComplianceSnapshot? @relation(fields: [complianceSnapshotId], references: [id])
  employee               ComplianceEmployee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  overrideActor          User?               @relation("WorkOrderAssignmentOverrideActor", fields: [overrideActorId], references: [id])
  workOrder              WorkOrder           @relation(fields: [workOrderId], references: [id], onDelete: Cascade)

  @@index([employeeId])
  @@index([workOrderId, unassignedAt])
}

model Asset {
  id          String                     @id @default(cuid())
  companyId   String
  assetName   String
  assetType   String
  assetNumber String
  status      AssetStatus                @default(IN_SERVICE)
  location    String?
  notes       String?
  createdAt   DateTime                   @default(now())
  updatedAt   DateTime                   @updatedAt
  subType     String?
  createdById String
  company     Company                    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy   User                       @relation("AssetCreator", fields: [createdById], references: [id])
  assignments WorkOrderAssetAssignment[]

  @@unique([companyId, assetNumber])
  @@index([companyId, status])
}

model WorkOrderAssetAssignment {
  id                  String      @id @default(cuid())
  workOrderId         String
  assetId             String
  assignedById        String?
  removedById         String?
  statusAtAssignment  AssetStatus
  assetNameSnapshot   String
  assetTypeSnapshot   String
  assetNumberSnapshot String
  assignedAt          DateTime    @default(now())
  removedAt           DateTime?
  asset               Asset       @relation(fields: [assetId], references: [id], onDelete: Cascade)
  assignedBy          User?       @relation("WorkOrderAssetAssignmentAssigner", fields: [assignedById], references: [id])
  removedBy           User?       @relation("WorkOrderAssetAssignmentRemover", fields: [removedById], references: [id])
  workOrder           WorkOrder   @relation(fields: [workOrderId], references: [id], onDelete: Cascade)

  @@index([workOrderId])
  @@index([assetId, removedAt])
  @@index([workOrderId, removedAt])
}

model WorkOrderActivity {
  id             String                @id @default(cuid())
  companyId      String
  workOrderId    String
  actorId        String?
  type           WorkOrderActivityType
  previousStatus WorkOrderStatus?
  newStatus      WorkOrderStatus?
  metadata       Json?
  createdAt      DateTime              @default(now())
  actor          User?                 @relation("WorkOrderActivityActor", fields: [actorId], references: [id])
  company        Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  workOrder      WorkOrder             @relation(fields: [workOrderId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([workOrderId, createdAt])
}

model UserInvite {
  id          String           @id @default(cuid())
  companyId   String
  email       String
  role        String
  token       String           @unique
  invitedById String?
  acceptedAt  DateTime?
  revokedAt   DateTime?
  expiresAt   DateTime
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  auditLogs   AccessAuditLog[]
  company     Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  invitedBy   User?            @relation("InviteSender", fields: [invitedById], references: [id])

  @@index([companyId])
}

model AccessAuditLog {
  id             String            @id @default(cuid())
  companyId      String
  actorId        String?
  targetUserId   String?
  targetInviteId String?
  action         AccessAuditAction
  metadata       Json?
  createdAt      DateTime          @default(now())
  actor          User?             @relation("AccessActor", fields: [actorId], references: [id])
  company        Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  targetInvite   UserInvite?       @relation(fields: [targetInviteId], references: [id])
  targetUser     User?             @relation("AccessTarget", fields: [targetUserId], references: [id])

  @@index([companyId])
  @@index([action])
}

model SystemSetting {
  id          String   @id @default(cuid())
  companyId   String
  key         String
  value       Json
  updatedById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  updatedBy   User?    @relation("SystemSettingUpdatedBy", fields: [updatedById], references: [id])

  @@unique([companyId, key])
}

model EmailTemplate {
  id             String             @id @default(cuid())
  companyId      String
  name           String
  subject        String
  body           String
  scope          EmailTemplateScope @default(global)
  isDefault      Boolean            @default(false)
  createdById    String
  updatedById    String
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  company        Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy      User               @relation("EmailTemplateCreator", fields: [createdById], references: [id])
  updatedBy      User               @relation("EmailTemplateUpdater", fields: [updatedById], references: [id])
  estimateEmails EstimateEmail[]

  @@unique([companyId, name])
  @@index([companyId, scope])
}

model EmailSignature {
  id             String          @id @default(cuid())
  companyId      String
  name           String
  content        String
  isActive       Boolean         @default(false)
  createdById    String
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  company        Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy      User            @relation(fields: [createdById], references: [id])
  estimateEmails EstimateEmail[]
}

model EmailRecipientPreference {
  id          String   @id @default(cuid())
  companyId   String
  email       String
  sendEnabled Boolean  @default(true)
  reason      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, email])
}

model SystemEmailLog {
  id           String   @id @default(cuid())
  eventType    String
  formType     String
  recipient    String
  sender       String
  payload      Json?
  success      Boolean
  errorMessage String?
  attemptedAt  DateTime @default(now())

  @@index([eventType])
  @@index([formType])
  @@index([success])
}

enum PlanKey {
  starter
  growth
  pro
  enterprise
}

enum CompanyKind {
  account
  client
}

enum ComplianceStatus {
  PASS
  FAIL
  INCOMPLETE
}

enum CertificationStatus {
  PASS
  FAIL
  EXPIRED
  INCOMPLETE
}

enum ComplianceCategory {
  BASE
  RAILROAD
  CONSTRUCTION
  ENVIRONMENTAL
}

enum CompanyComplianceDocumentCategory {
  INSURANCE
  POLICIES
  PROGRAMS
  RAILROAD
}

enum ComplianceActivityType {
  CERT_ADDED
  CERT_IMAGE_UPLOADED
  CERT_IMAGE_VERSIONED
  CERT_EXPIRED
  SNAPSHOT_CREATED
  QR_GENERATED
  COMPLIANCE_PRINTED
  COMPLIANCE_EXPORTED
  EMPLOYEE_CREATED
  EMPLOYEE_DEACTIVATED
  EMPLOYEE_REACTIVATED
  DOC_UPLOADED
  DOC_VERSIONED
  EMPLOYEE_UPDATED
}

enum EstimateStatus {
  DRAFT
  AWAITING_APPROVAL
  APPROVED
  SENT_TO_DISPATCH
  RETURNED_TO_USER  @map("REVISION_REQUIRED")
}

enum EstimateIndustry {
  RAILROAD      @map("RAIL")
  CONSTRUCTION
  ENVIRONMENTAL
}

enum EstimateDocumentKind {
  ESTIMATE
  QUOTE
}

enum BidDocumentCategory {
  PLANS
  SPECIFICATIONS
  ADDENDA
  RFP_IFB
  CLARIFICATIONS
  CUSTOMER_PROVIDED
  SUBCONTRACTOR
  SITE_INSTRUCTIONS
  ACCESS_DETAILS
  SAMPLING_PLAN
  HISTORICAL_REPORT
  REGULATORY
  DAILY_LOG
  PHOTO
  OTHER
}

enum ContactActivityState {
  NEW
  ACTIVE
  STALE
  AT_RISK
}

enum ContactCallDirection {
  INBOUND
  OUTBOUND
}

enum ContactMeetingType {
  DISCOVERY
  REVIEW
  SITE_VISIT
  OTHER
}

enum ContactSocialPlatform {
  LINKEDIN
  X
  INSTAGRAM
  FIELD
  OTHER
}

enum EmailDirection {
  INBOUND
  OUTBOUND
}

enum EstimatePresetIndustry {
  BASE
  RAILROAD
  CONSTRUCTION
  ENVIRONMENTAL
}

enum DispatchRequestStatus {
  QUEUED
  PENDING_ASSIGNMENT
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum WorkOrderDiscipline {
  CONSTRUCTION
  RAILROAD
  ENVIRONMENTAL
}

enum WorkOrderStatus {
  DRAFT
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum DispatchPresetScope {
  BASE
  CONSTRUCTION
  RAILROAD
  ENVIRONMENTAL
}

enum WorkOrderActivityType {
  STATUS_CHANGED
  EMPLOYEE_ASSIGNED
  EMPLOYEE_UNASSIGNED
  COMPLIANCE_OVERRIDE
  ASSET_ASSIGNED
  ASSET_REMOVED
  NOTE_ADDED
  NOTE_UPDATED
  DOCUMENT_UPLOADED
  PDF_GENERATED
  EMAIL_SENT
  DISPATCH_PRESET_ADDED
  DISPATCH_PRESET_REMOVED
  DISPATCH_PRESET_NOTE_UPDATED
}

enum AccessAuditAction {
  INVITE_CREATED
  INVITE_REVOKED
  INVITE_ACCEPTED
  ROLE_CHANGED
  USER_DISABLED
  USER_ENABLED
  INVITE_TOGGLE_UPDATED
  DISPATCH_REASSIGNED
  WORK_ORDER_CLOSED
  COMPLIANCE_OVERRIDE_APPROVED
  COMPLIANCE_POLICY_UPDATED
  WORK_ORDER_MANUAL_CREATED
  ESTIMATE_APPROVED
  ESTIMATE_CREATED
  ESTIMATE_UPDATED
  ESTIMATE_REVISION_CREATED
  ESTIMATE_RETURNED_TO_USER
  CONTACT_CREATED
  CONTACT_UPDATED
  TASK_CREATED
  TASK_UPDATED
  TASK_COMPLETED
  NOTE_ADDED
  CALL_LOGGED
  MEETING_LOGGED
  SOCIAL_LOGGED
  DEAL_BID_DOCUMENT_UPLOADED
  DEAL_BID_DOCUMENT_DOWNLOADED
  DEAL_BID_DOCUMENT_EMAILED
  ESTIMATE_SUBMITTED
  ESTIMATE_VIEWED
  ESTIMATE_EMAILED
  ESTIMATE_SENT_TO_DISPATCH
  PDF_GENERATED
  EMAIL_SENT
  EMAIL_RECEIVED
  EMAIL_ATTACHMENT_UPLOADED
  EMAIL_RECEIVED_UNLINKED
  EMAIL_LINKED_TO_CONTACT
  MENTION_CREATED
  DEAL_CREATED_FROM_CONTACT
  WORKORDER_CREATED_FROM_CONTACT
  EMAIL_SETTINGS_CHANGED
  EMAIL_PROVIDER_CONNECTED
  EMAIL_PROVIDER_DISCONNECTED
  EMAIL_TEMPLATE_CREATED
  EMAIL_TEMPLATE_UPDATED
  EMAIL_TEMPLATE_DELETED
  EMAIL_TEMPLATE_DEFAULT_SET
  EMAIL_SIGNATURE_CREATED
  EMAIL_SIGNATURE_UPDATED
  EMAIL_SIGNATURE_DELETED
  EMAIL_SIGNATURE_ACTIVATED
  WELCOME_EMAIL_SENT
  EMAIL_RECIPIENT_TOGGLED
  LOGO_UPLOADED
  LOGO_UPDATED
  CUSTOM_ACTIVITY_LOGGED
  WORKORDER_STATUS_CHANGED
  WORKORDER_EMPLOYEE_ASSIGNED
  WORKORDER_COMPLIANCE_OVERRIDE
  WORKORDER_ASSET_ASSIGNED
  WORKORDER_ASSET_REMOVED
  DISPATCH_RECEIVED_ESTIMATE
  DISPATCH_RECEIVED_QUOTE
  DISPATCH_PRESET_APPLIED
  DISPATCH_PRESET_UPDATED
  DISPATCH_PRESET_REORDERED
  WORKORDER_CREATED
  BLANK_WORKORDER_CREATED
  CONTACT_LINKED_TO_WORKORDER
  WORKORDER_STATUS_UPDATED
  EMPLOYEE_BLOCKED_BY_COMPLIANCE
  COMPLIANCE_OVERRIDE_APPLIED
  COMPLIANCE_CHECK_FAILED
  WORKORDER_RETURNED_TO_USER
  DOCUMENT_UPLOADED
  ASSET_CREATED
  ASSET_UPDATED
  ASSET_STATUS_CHANGED
  ASSET_ASSIGNED_TO_WORKORDER
  ASSET_REMOVED_FROM_WORKORDER
  WORKORDER_NOTE_ADDED
  WORKORDER_NOTE_UPDATED
  ESTIMATING_PRESET_CREATED
  ESTIMATING_PRESET_UPDATED
  ESTIMATING_PRESET_REORDERED
  ESTIMATING_PRESET_DISABLED
  SEAT_CAP_REACHED
  INVITE_BLOCKED_SEAT_LIMIT
  ROLE_CHANGE_BLOCKED_SEAT_LIMIT
  SEAT_COUNT_MISMATCH_STRIPE
  SEAT_QUANTITY_UPDATED
}

enum AssetStatus {
  IN_SERVICE
  OUT_OF_SERVICE
  MAINTENANCE
}

enum EmailProvider {
  gmail
  outlook
}

enum EmailTemplateScope {
  crm
  estimating
  dispatch
  work_orders
  global
}
